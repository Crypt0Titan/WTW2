{% extends 'base.html' %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">Welcome to Win The Wallet</h1>

<div class="bg-white p-6 rounded-lg shadow-md mb-6">
    <h2 class="text-xl font-semibold mb-4">Important Information</h2>
    <p class="mb-2">To be eligible for rewards, you need to be holding $25 worth of Coin X.</p>
    <p class="mb-2">Contract Address: <span class="font-mono bg-gray-100 p-1 rounded">0x1234567890123456789012345678901234567890</span></p>
    <p class="mb-2">
        <a href="#" class="text-blue-600 hover:underline">Buy Coin X on Uniswap</a>
    </p>
</div>

<h2 class="text-2xl font-bold mb-4">Available Games</h2>

<div class="mb-4">
    <label for="sort-select" class="mr-2">Sort by:</label>
    <select id="sort-select" class="border rounded p-1">
        <option value="pot-size">Pot Size</option>
        <option value="start-time">Start Time</option>
    </select>
</div>

<div id="games-list" class="games-grid">
    {% for game in games %}
    <div class="bg-white p-4 rounded-lg shadow-md game-item" data-game-id="{{ game.id }}">
        <h3 class="text-lg font-semibold mb-2">Game #{{ game.id }}</h3>
        <p class="mb-1 text-sm"><i class="fas fa-trophy mr-2 text-yellow-500"></i>Pot: $<span class="pot-size">{{ "%.2f"|format(game.pot_size) }}</span></p>
        <p class="mb-1 text-sm"><i class="fas fa-coins mr-2 text-green-500"></i>Entry: ${{ "%.2f"|format(game.entry_value) }}</p>
        <p class="mb-1 text-sm"><i class="fas fa-users mr-2 text-blue-500"></i>Players: <span class="player-count">{{ game.players.count() }}</span> / {{ game.max_players }}</p>
        <p class="mb-1 text-sm"><i class="far fa-clock mr-2 text-red-500"></i>Start: <span class="start-time">{{ game.start_time.strftime('%Y-%m-%d %H:%M:%S') }}</span></p>
        <a href="{{ url_for('join_game', game_id=game.id) }}" class="btn btn-blue mt-2 text-sm">Join Game</a>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('sort-select').addEventListener('change', function() {
    const sortBy = this.value;
    const gamesList = document.getElementById('games-list');
    const games = Array.from(gamesList.children);

    games.sort((a, b) => {
        if (sortBy === 'pot-size') {
            const potA = parseFloat(a.querySelector('.pot-size').textContent);
            const potB = parseFloat(b.querySelector('.pot-size').textContent);
            return potB - potA;
        } else {
            const timeA = new Date(a.querySelector('.start-time').textContent);
            const timeB = new Date(b.querySelector('.start-time').textContent);
            return timeA - timeB;
        }
    });

    games.forEach(game => gamesList.appendChild(game));
});

socket.on('new_game', function(data) {
    const gamesList = document.getElementById('games-list');
    const newGame = document.createElement('div');
    newGame.className = 'bg-white p-4 rounded-lg shadow-md game-item';
    newGame.setAttribute('data-game-id', data.game_id);
    newGame.innerHTML = `
        <h3 class="text-lg font-semibold mb-2">Game #${data.game_id}</h3>
        <p class="mb-1 text-sm"><i class="fas fa-trophy mr-2 text-yellow-500"></i>Pot: $<span class="pot-size">${data.pot_size.toFixed(2)}</span></p>
        <p class="mb-1 text-sm"><i class="fas fa-coins mr-2 text-green-500"></i>Entry: $0.00</p>
        <p class="mb-1 text-sm"><i class="fas fa-users mr-2 text-blue-500"></i>Players: <span class="player-count">0</span> / 0</p>
        <p class="mb-1 text-sm"><i class="far fa-clock mr-2 text-red-500"></i>Start: <span class="start-time">${new Date(data.start_time).toLocaleString()}</span></p>
        <a href="/game/${data.game_id}/join" class="btn btn-blue mt-2 text-sm">Join Game</a>
    `;
    gamesList.insertBefore(newGame, gamesList.firstChild);
});

socket.on('player_joined', function(data) {
    const game = document.querySelector(`[data-game-id="${data.game_id}"]`);
    if (game) {
        const playerCount = game.querySelector('.player-count');
        playerCount.textContent = data.player_count;
    }
});

socket.on('game_started', function(data) {
    const game = document.querySelector(`[data-game-id="${data.game_id}"]`);
    if (game) {
        game.remove();
    }
});
</script>
{% endblock %}
