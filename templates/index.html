{% extends 'base.html' %}

{% block content %}
<div class="futuristic-container">
    <h1 class="text-5xl font-bold text-center text-cyan-400 mb-12">Welcome to Win The Wallet</h1>

    <div class="stats-container">
        <div class="stats-row">
            <div class="stat-item">
                <i class="fas fa-gamepad"></i>
                <span class="stat-title"># of Games</span>
                <span class="stat-value">{{ statistics.total_games }}</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-coins"></i>
                <span class="stat-title">Rewards Distributed</span>
                <span class="stat-value">${{ "%.2f"|format(statistics.total_rewards) }}</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-users"></i>
                <span class="stat-title">Total Number of Players</span>
                <span class="stat-value">{{ statistics.total_players }}</span>
            </div>
        </div>
        <div class="stats-row">
            <div class="stat-item">
                <i class="fas fa-clock"></i>
                <span class="stat-title">Time Spent In-Game</span>
                <span class="stat-value">{{ (statistics.total_time / 3600)|round(1) }} hours</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-hourglass-half"></i>
                <span class="stat-title">Avg. Time Per Game</span>
                <span class="stat-value">{{ (statistics.avg_time_per_game / 60)|round(1) }} minutes</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-trophy"></i>
                <span class="stat-title">Earnings / Winner</span>
                <span class="stat-value">${{ "%.2f"|format(statistics.avg_earnings_per_winner) }}</span>
            </div>
        </div>
    </div>

    <div class="info-container">
        <h2 class="neon-text mb-4">Important Information</h2> <!-- Added margin-bottom -->

        <p class="mb-4">To be eligible for rewards, you need to be holding $25 worth of Coin X.</p> <!-- Added margin-bottom -->

        <p class="mb-4">Contract Address: <span class="contract-address">0x1234567890123456789012345678901234567890</span></p> <!-- Added margin-bottom -->

        <a href="#" class="neon-button mt-4">Buy Coin X on Uniswap</a> <!-- Added margin-top -->
    </div>

    <h1 class="text-5xl font-bold text-center text-cyan-400 mb-12">Available Games</h1>

    <div class="sort-container">
        <label for="sort-select">Sort by:</label>
        <select id="sort-select" class="futuristic-select">
            <option value="pot-size">Pot Size</option>
            <option value="start-time">Start Time</option>
        </select>
    </div>


    <div id="games-list" class="games-grid">
        {% for game in games %}
        <div class="game-card" data-game-id="{{ game.id }}">
            <h3 class="game-title">Game #{{ game.id }}</h3>
            <p><i class="fas fa-trophy"></i> Pot: $<span class="pot-size">{{ "%.2f"|format(game.pot_size) }}</span></p>
            <p><i class="fas fa-coins"></i> Entry: ${{ "%.2f"|format(game.entry_value) }}</p>
            <p><i class="fas fa-users"></i> Players: <span class="player-count">{{ len(game.players) }}</span> / {{ game.max_players }}</p>
            <p><i class="far fa-clock"></i> Start: <span class="start-time">{{ game.start_time.strftime('%Y-%m-%d %H:%M:%S') }}</span></p>
            <a href="{{ url_for('main.join_game', game_id=game.id) }}" class="neon-button">Join Game</a>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('sort-select').addEventListener('change', function() {
    const sortBy = this.value;
    const gamesList = document.getElementById('games-list');
    const games = Array.from(gamesList.children);

    games.sort((a, b) => {
        if (sortBy === 'pot-size') {
            const potA = parseFloat(a.querySelector('.pot-size').textContent);
            const potB = parseFloat(b.querySelector('.pot-size').textContent);
            return potB - potA;
        } else {
            const timeA = new Date(a.querySelector('.start-time').textContent);
            const timeB = new Date(b.querySelector('.start-time').textContent);
            return timeA - timeB;
        }
    });

    games.forEach(game => gamesList.appendChild(game));
});

socket.on('new_game', function(data) {
    const gamesList = document.getElementById('games-list');
    const newGame = document.createElement('div');
    newGame.className = 'game-card';
    newGame.setAttribute('data-game-id', data.game_id);
    newGame.innerHTML = `
        <h3 class="game-title">Game #${data.game_id}</h3>
        <p><i class="fas fa-trophy"></i> Pot: $<span class="pot-size">${data.pot_size.toFixed(2)}</span></p>
        <p><i class="fas fa-coins"></i> Entry: $0.00</p>
        <p><i class="fas fa-users"></i> Players: <span class="player-count">0</span> / ${data.max_players}</p>
        <p><i class="far fa-clock"></i> Start: <span class="start-time">${new Date(data.start_time).toLocaleString()}</span></p>
        <a href="/game/${data.game_id}/join" class="neon-button">Join Game</a>
    `;
    gamesList.insertBefore(newGame, gamesList.firstChild);
});

socket.on('player_joined', function(data) {
    const game = document.querySelector(`[data-game-id="${data.game_id}"]`);
    if (game) {
        const playerCount = game.querySelector('.player-count');
        playerCount.textContent = data.player_count;
    }
});

socket.on('game_started', function(data) {
    const game = document.querySelector(`[data-game-id="${data.game_id}"]`);
    if (game) {
        game.remove();
    }
});
</script>
{% endblock %}
